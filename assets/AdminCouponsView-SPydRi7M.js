import{_,S as b,h as m,o as u,c,b as t,l as r,v as h,O as D,t as p,e as f,r as C,F as v,i as x,d as g}from"./index-3jQ3BWfN.js";import{M as T}from"./modal-kKForfFL.js";/* empty css              */var V={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:M,VITE_PATH:w}=V,k={props:["tempCoupons","isNew","clearInput"],emits:["update-coupon"],data(){return{couponModal:null,localTempCoupons:{},due_date:"",Swal:b}},components:{},methods:{showModal(){this.couponModal.show()},hideModal(){this.couponModal.hide()},setDueDate(){if(this.isNew===!0)this.due_date=this.localTempCoupons.getCurrentDate(),console.log("這個你",this.due_date);else{const s=new Date(this.tempCoupons.due_date*1e3),e=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");this.due_date=`${e}/${n}/${a}`,console.log(this.due_date,this.year,this.month,this.date)}},getCurrentDate(){const s=new Date,e=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${e}/${n}/${a}`},updateCoupon(s){this.isLoading=!0,this.fullpage=!0;let e=`${M}/v2/api/${w}/admin/coupon`,n="post",a=s;this.isNew||(e=`${M}/v2/api/${w}/admin/coupon/${this.tempCoupons.id}`,n="put",a=this.tempCoupons),m[n](e,{data:a}).then(o=>{this.isLoading=!1,this.fullpage=!1,this.$emit("update"),b.fire({title:"已更新",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1}),this.hideModal()}).catch(o=>{this.$Swal.fire({icon:"error",title:o.response.data.message})})}},watch:{tempCoupons:{handler(){this.localTempCoupons=this.tempCoupons},deep:!0},due_date(){this.localTempCoupons.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponModal=new T(this.$refs.couponModal,{keyboard:!1,backdrop:"static"}),this.localTempCoupons=this.tempCoupons,this.setDueDate()}},E={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},L={class:"modal-content border-0"},U={class:"modal-header bg-dark text-white"},I={id:"couponLabel",class:"modal-title"},R={key:0},N={key:1},A=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),P={class:"modal-body"},B={class:"row"},H={class:"col-sm-12"},O={class:"mb-3 text-start"},F=t("label",{for:"title",class:"form-label"},"優惠券標題",-1),Y={class:"row text-start"},j={class:"mb-3 col-md-6"},q=t("label",{for:"category",class:"form-label"},"優惠卷代碼",-1),z={class:"mb-3 col-md-6"},G=t("label",{for:"unit",class:"form-label"},"折扣百分比",-1),J={class:"row text-start"},K={class:"mb-3 col-md-6"},Q=t("label",{for:"dueDate",class:"form-label"},"到期日",-1),W={class:"mb-3 text-start"},X={class:"form-check"},Z=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),tt={class:"modal-footer"},et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ot(s,e,n,a,o,d){return u(),c("div",E,[t("div",S,[t("div",L,[t("div",U,[t("h5",I,[n.isNew?(u(),c("span",R,"新增優惠卷")):(u(),c("span",N,"編輯優惠卷"))]),A]),t("div",P,[t("div",B,[t("div",H,[t("div",O,[F,r(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=l=>o.localTempCoupons.title=l)},null,512),[[h,o.localTempCoupons.title]])]),t("div",Y,[t("div",j,[q,r(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入代碼","onUpdate:modelValue":e[1]||(e[1]=l=>o.localTempCoupons.code=l)},null,512),[[h,o.localTempCoupons.code]])]),t("div",z,[G,r(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入數字","onUpdate:modelValue":e[2]||(e[2]=l=>o.localTempCoupons.percent=l)},null,512),[[h,o.localTempCoupons.percent,void 0,{number:!0}]])])]),t("div",J,[t("div",K,[Q,r(t("input",{id:"dueDate",type:"number",min:"0",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=l=>o.due_date=l)},null,512),[[h,o.due_date]])])]),t("div",W,[t("div",X,[r(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>o.localTempCoupons.is_enabled=l),"true-value":1,"false-value":0},null,512),[[D,o.localTempCoupons.is_enabled]]),Z])])])])]),t("div",tt,[et,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=l=>d.updateCoupon(o.localTempCoupons))},p(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const st=_(k,[["render",ot]]);var nt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:lt,VITE_PATH:at}=nt,dt={props:["coupons","tempCoupons","getCoupon"],data(){return{delCouponModal:null,data:""}},methods:{showModal(){this.delCouponModal.show()},hideModal(){this.delCouponModal.hide()},deleteCoupon(){const s=`${lt}/api/${at}/admin/coupon/${this.tempCoupons.id}`;m.delete(s,{data:this.tempCoupons}).then(e=>{this.$Swal.fire({icon:"success",title:"成功刪除產品",showConfirmButton:!1,timer:1500}),this.hideModal(),this.$emit("update")}).catch(e=>{alert(e.response.data.message)})}},mounted(){this.delCouponModal=new T(this.$refs.delCouponModal,{keyboard:!1,backdrop:"static"}),console.log(this.tempCoupons)}},it={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},ut={class:"modal-dialog"},ct={class:"modal-content border-0"},pt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delCouponModalLabel",class:"modal-title"},[t("span",null,"刪除優惠卷")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),rt={class:"modal-body text-start"},ht=t("strong",{class:"text-danger"},[t("span",{class:"fw-bold"})],-1),_t=t("div",{class:"mt-2"}," (刪除後將無法恢復)。 ",-1),mt={class:"modal-footer"},bt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ft(s,e,n,a,o,d){return u(),c("div",it,[t("div",ut,[t("div",ct,[pt,t("div",rt,[f(" 是否刪除 "),ht,f(" "+p(n.tempCoupons.title)+" 優惠券 ",1),_t]),t("div",mt,[bt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...l)=>d.deleteCoupon&&d.deleteCoupon(...l))}," 確認刪除 ")])])])],512)}const Ct=_(dt,[["render",ft]]);var vt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:gt,VITE_PATH:Mt}=vt,wt={data(){return{coupons:[],tempCoupons:{},pagination:{},isNew:!1,isLoading:!0}},components:{CouponModal:st,CouponDelModal:Ct},methods:{getCoupon(s=1){const e=`${gt}/v2/api/${Mt}/admin/coupons?page=${s}`;m.get(e).then(n=>{const{coupons:a,pagination:o}=n.data;this.allCoupons=a,this.coupons=a,this.pagination=o}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})})},formatDate(s){return new Date(s*1e3).toLocaleDateString()},openCouponModal(s,e){s==="createNew"?(this.tempCoupon={due_date:Math.floor(new Date().getTime()/1e3),is_enabled:0},this.isNew=!0,this.$refs.couponModal.showModal()):s==="edit"?(this.tempCoupons={...e},this.isNew=!1,this.$refs.couponModal.showModal()):s==="delete"&&(this.tempCoupons={...e},this.$refs.couponDelModal.showModal())},clearInput(){this.tempCoupons={}}},mounted(){this.getCoupon()}},Tt={class:"container"},$t={class:"d-flex justify-content-between py-4 py-md-5"},yt=t("h2",{class:"fw-bold"},"酷碰管理",-1),Dt={class:"table table-hover mt-4"},xt=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 名稱 "),t("th",null,"酷碰代碼"),t("th",{width:"120"}," 折扣 "),t("th",{width:"120"}," 期限 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1),Vt={key:0,class:"text-success"},kt={key:1},Et={class:"btn-group"},St=["onClick"],Lt=["onClick"];function Ut(s,e,n,a,o,d){const l=C("CouponModal"),$=C("CouponDelModal");return u(),c(v,null,[t("div",Tt,[t("div",$t,[yt,t("button",{class:"btn btn-outline-primary",onClick:e[0]||(e[0]=i=>d.openCouponModal("createNew"))}," + 新增酷碰卷 ")]),t("table",Dt,[xt,t("tbody",null,[(u(!0),c(v,null,x(o.coupons,i=>(u(),c("tr",{key:i.id},[t("td",null,p(i.title),1),t("td",null,p(i.code),1),t("td",null,p(i.percent)+"%",1),t("td",null,p(d.formatDate(i.due_date)),1),t("td",null,[i.is_enabled?(u(),c("span",Vt,"啟用")):(u(),c("span",kt,"未啟用"))]),t("td",null,[t("div",Et,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y=>d.openCouponModal("edit",i)}," 編輯 ",8,St),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y=>d.openCouponModal("delete",i)}," 刪除 ",8,Lt)])])]))),128))])])]),g(l,{ref:"couponModal","temp-Coupons":o.tempCoupons,"is-new":o.isNew,"clear-input":d.clearInput,onUpdate:d.getCoupon},null,8,["temp-Coupons","is-new","clear-input","onUpdate"]),g($,{ref:"couponDelModal","is-new":o.isNew,"temp-Coupons":o.tempCoupons,onUpdate:d.getCoupon},null,8,["is-new","temp-Coupons","onUpdate"])],64)}const At=_(wt,[["render",Ut]]);export{At as default};
