import{_ as L,L as I,h,a as U,m as b,r as v,o as c,c as u,b as t,d as i,w as x,q as w,F as P,i as $,e as g,t as p,k as V,v as S,f as E,s as k}from"./index-yin_xtmD.js";import{c as _}from"./cartStore-pWKnpFbl.js";/* empty css              */var N={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:m}=N,A={data(){return{cart:{},product:{},orderId:"",form:{user:{name:"",email:"",tel:"",address:""},message:""},coupon:"",isLoading:!0,fullPage:!0,loader:"bars"}},components:{Loading:I},methods:{getCarts(){this.isLoading=!0,h.get(`${f}/v2/api/${m}/cart`).then(o=>{this.cart=o.data.data,this.totalPrice=o.data.data.total,this.isLoading=!1,console.log(this.cart)})},changeCartQty(o,s=1){const d={product_id:o.product_id,qty:o.qty};h.put(`${f}/v2/api/${m}/cart/${o.id}`,{data:d}).then(n=>{console.log(n),this.getCarts()})},updateCart(o){const s=`${m}/v2/api/${m}/cart/${o.id}`,d={product_id:o.product_id,qty:o.qty};h.put(s,{data:d}).then(n=>{alert(n.data.message),this.getCart()}).catch(n=>{alert(n.response.data.message)})},removeCartItem(o,s){this.$Swal.fire({title:"確定刪除此商品?",icon:"warning",showConfirmButton:!0,confirmButtonText:"確定",cancelButtonText:"取消",showCancelButton:!0}).then(d=>{d.isConfirmed&&h.delete(`${f}/v2/api/${m}/cart/${s}`).then(n=>{this.$Swal.fire({title:"已刪除",icon:"success",timer:1e3,showConfirmButton:!1}),this.getCarts()}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})})})},deleteAllCarts(){const o=`${f}/v2/api/${m}/carts`;h.delete(o).then(s=>{this.$Swal.fire({title:"成功刪除所有商品",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1}),this.getCart()}).catch(s=>{this.$Swal.fire({icon:"error",title:s.response.data.message})})},...U(_,["addToCart","getCart"]),createOrder(o){const s=`${f}/v2/api/${m}/order`,d=this.form;h.post(s,{data:d}).then(n=>{this.$Swal.fire({icon:"success",title:"訂單成立"}),this.$refs.form.resetForm(),this.orderId=n.data.orderId,this.$router.push(`/paycheck/${n.data.orderId}`),localStorage.setItem("orderId",n.data.orderId),this.getCarts()}).catch(()=>{this.$Swal.fire({icon:"error",title:"訂單失敗"})})},useCoupon(o){const s=`${f}/v2/api/${m}/coupon`,d={data:{code:o}};h.post(s,d).then(n=>{this.getCart(),this.$Swal.fire({title:"套用成功",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1})}).catch(()=>{this.$Swal.fire({icon:"error",title:"套用失敗"})})},formatPrice(o){return o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},computed:{...b(_,["carts"]),...b(_,["total","final_total"]),...b(_,["cartList"]),...b(_,["cartListTotalQty"]),...b(_,["updateCart"])},mounted(){this.getCarts()}},F={class:"bg-primary"},j={class:"container text-info"},R=E('<div class="row py-md-6"><div class="col-md-3 pt-6 col-sm-5"><div class="border-bottom mb-2"><h2>訂單確認。</h2></div></div><div class="col-8"></div></div><div class="row text-center"><div class="col-4 step state rounded-start">1.填寫資料</div><div class="col-4 step">2.確認付款</div><div class="col-4 step rounded-end">3.完成訂單</div></div>',2),D={class:"row py-4"},H={class:"col-md-8 col-sm-12"},M={key:0,class:"d-flex justify-content-between mb-4"},O=t("button",{type:"submit",class:"btn btn-info"},"繼續購買",-1),Q={key:1,class:"table-container"},z={class:"table align-middle"},G=t("thead",{class:"table-dark"},[t("tr",null,[t("th",null,"圖片"),t("th",null,"房名"),t("th",null,"價格"),t("th",null,"數量"),t("th",null,"小計"),t("th")])],-1),J={class:"table-primary"},K=["src"],W={style:{width:"20%"}},X={style:{width:"30%"}},Y={class:"btn-group input-group-sm"},Z=["onClick","onBlur","disabled"],tt=["onUpdate:modelValue","onChange","disabled"],et=["onBlur","onClick"],st={style:{width:"10%"},class:"text-end"},ot=["onClick"],lt=t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash-fill",viewBox:"0 0 16 16"},[t("path",{d:"M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"})],-1),at=[lt],nt={key:2,class:"text-info d-flex align-items-center justify-content-center mb-2",style:{height:"300px","background-color":"rgba(99, 99, 99, 0.9)","z-index":"100"}},rt=t("button",{type:"submit",class:"btn btn-info ms-2"},"去逛逛",-1),it={key:3,class:"border bg-secondary p-4"},dt=t("h2",null,"訂單明細",-1),ct=t("hr",null,null,-1),ut={class:"d-flex justify-content-between mb-4"},mt=t("h5",null,"小計",-1),ht={class:"d-flex mb-2"},pt={class:"input-group total-coupon-input"},_t={key:0,class:"text-dark mb-2"},ft={class:"d-flex justify-content-between mb-4"},bt=t("h5",null,"酷碰券折抵",-1),vt={class:"d-flex justify-content-between"},gt=t("h5",null,"共計",-1),yt={key:0,class:"col-md-4 col-sm-12"},Ct={class:"row justify-content-center py-4"},wt={class:"mb-3"},kt=t("label",{for:"email",class:"form-label"},[g("Email"),t("span",{class:"marker"},"*")],-1),xt={class:"mb-3"},Vt=t("label",{for:"name",class:"form-label"},[g("收件人姓名"),t("span",{class:"marker"},"*")],-1),St={class:"mb-3"},qt=t("label",{for:"tel",class:"form-label"},[g("收件人電話"),t("span",{class:"marker"},"*")],-1),Bt={class:"mb-3"},Tt=t("label",{for:"address",class:"form-label"},[g("收件人地址"),t("span",{class:"marker"},"*")],-1),Lt={class:"mb-3"},It=t("label",{for:"message",class:"form-label"},"留言",-1),Ut=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-secondary"}," 送出訂單 ")],-1);function Pt(o,s,d,n,l,r){const B=v("Loading"),q=v("router-link"),y=v("v-field"),C=v("error-message"),T=v("v-form");return c(),u("div",F,[t("div",j,[i(B,{active:l.isLoading,"onUpdate:active":s[0]||(s[0]=e=>l.isLoading=e),"can-cancel":!1,"is-full-page":l.fullPage,loader:l.loader},null,8,["active","is-full-page","loader"]),R,t("div",D,[t("div",H,[o.carts.length>0?(c(),u("div",M,[i(q,{to:"/products"},{default:x(()=>[O]),_:1}),t("button",{type:"submit",class:"btn btn-outline-info",onClick:s[1]||(s[1]=(...e)=>r.deleteAllCarts&&r.deleteAllCarts(...e))}," 清空購物車 ")])):w("",!0),o.carts.length>0?(c(),u("div",Q,[t("table",z,[G,t("tbody",J,[(c(!0),u(P,null,$(l.cart.carts,e=>(c(),u("tr",{key:e.id},[t("td",null,[t("img",{src:e.product.imageUrl,style:{width:"80px",height:"100px"}},null,8,K)]),t("td",null,[t("h5",null,p(e.product.title),1)]),t("td",W,[t("h5",null,"NT$"+p(r.formatPrice(e.product.price.toFixed(0))),1)]),t("td",X,[t("div",Y,[t("button",{type:"button",class:"btn btn-secondary",onClick:a=>e.qty--,onBlur:a=>r.changeCartQty(e,e.qty),disabled:e.qty===1}," - ",40,Z),V(t("input",{min:"1",type:"number",class:"productNumber","onUpdate:modelValue":a=>e.qty=a,onChange:a=>o.cartStore.updateCart(e),disabled:e.qty===1,readonly:""},null,40,tt),[[S,e.qty,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-secondary",onBlur:a=>r.changeCartQty(e,e.qty),onClick:a=>e.qty++}," + ",40,et)])]),t("td",null,[t("h5",null," $"+p(r.formatPrice((e.qty*e.product.price).toFixed(0))),1)]),t("td",st,[t("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>r.removeCartItem(e.product.title,e.id)},at,8,ot)])]))),128))])])])):(c(),u("div",nt,[g(" 購物車沒有任何商品，趕快去看喜歡的房型吧! "),i(q,{to:"/products"},{default:x(()=>[rt]),_:1})])),o.carts.length>0?(c(),u("div",it,[dt,ct,t("div",ut,[mt,t("span",null,"NT$ "+p(r.formatPrice(l.cart.total.toFixed(0))),1)]),t("div",ht,[t("form",pt,[V(t("input",{type:"text",placeholder:"輸入酷碰序號",class:"form-control","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":s[2]||(s[2]=e=>l.coupon=e)},null,512),[[S,l.coupon]]),t("button",{type:"submit",class:"btn btn-primary",id:"button-addon2",onClick:s[3]||(s[3]=e=>r.useCoupon(l.coupon))}," 套用 ")])]),l.cart.total-o.final_total?(c(),u("div",_t," 已套用優惠券 ")):w("",!0),t("div",ft,[bt,t("span",null,"NT$ "+p(r.formatPrice((l.cart.total-o.final_total).toFixed(0))),1)]),t("div",vt,[gt,t("span",null,"NT$ "+p(r.formatPrice(o.final_total.toFixed(0))),1)])])):w("",!0)]),o.carts.length>0?(c(),u("div",yt,[t("div",Ct,[i(T,{ref:"form",onSubmit:r.createOrder},{default:x(({errors:e})=>[t("div",wt,[kt,i(y,{id:"email",name:"email",type:"email",class:k(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":s[4]||(s[4]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),i(C,{name:"email",class:"invalid-feedback"})]),t("div",xt,[Vt,i(y,{id:"name",name:"姓名",type:"text",class:k(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名",rules:"required","aria-required":"true",modelValue:l.form.user.name,"onUpdate:modelValue":s[5]||(s[5]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),i(C,{name:"姓名",class:"invalid-feedback"})]),t("div",St,[qt,i(y,{id:"tel",name:"電話",type:"text",class:k(["form-control",{"is-invalid":e.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":s[6]||(s[6]=a=>l.form.user.tel=a)},null,8,["class","modelValue"]),i(C,{name:"電話",class:"invalid-feedback"})]),t("div",Bt,[Tt,i(y,{id:"address",name:"地址",type:"text",class:k(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":s[7]||(s[7]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),i(C,{name:"地址",class:"invalid-feedback"})]),t("div",Lt,[It,V(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[8]||(s[8]=a=>l.form.message=a)},null,512),[[S,l.form.message]])]),Ut]),_:1},8,["onSubmit"])])])):w("",!0)])])])}const At=L(A,[["render",Pt]]);export{At as default};
