import{_ as T,L,h as p,a as U,m as B,r as b,o as u,c,b as e,d as r,f as $,w,n as y,F as E,i as N,e as v,j as k,v as x,t as _,p as C}from"./index-W2fTsUi5.js";import{c as S}from"./cartStore-ggZVKP1r.js";/* empty css              */var P={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:m}=P,A={data(){return{cart:{},product:{},orderId:"",form:{user:{name:"",email:"",tel:"",address:""},message:""},coupon:"",isLoading:!0,fullPage:!0,loader:"bars"}},components:{Loading:L},methods:{getCarts(){this.isLoading=!0,p.get(`${f}/v2/api/${m}/cart`).then(o=>{this.cart=o.data.data,this.totalPrice=o.data.data.total,this.isLoading=!1})},changeCartQty(o,t=1){const i={product_id:o.product_id,qty:o.qty};p.put(`${f}/v2/api/${m}/cart/${o.id}`,{data:i}).then(n=>{console.log(n),this.getCarts()})},updateCart(o){const t=`${m}/v2/api/${m}/cart/${o.id}`,i={product_id:o.product_id,qty:o.qty};p.put(t,{data:i}).then(n=>{alert(n.data.message),this.getCart()}).catch(n=>{alert(n.response.data.message)})},removeCartItem(o,t){this.$Swal.fire({title:"確定刪除此商品?",icon:"warning",showConfirmButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(i=>{i.isConfirmed&&p.delete(`${f}/v2/api/${m}/cart/${t}`).then(n=>{this.$Swal.fire({title:"已刪除",icon:"success",timer:1e3,showConfirmButton:!1}),this.getCarts()}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})})})},deleteAllCarts(){const o=`${f}/v2/api/${m}/carts`;p.delete(o).then(t=>{this.$Swal.fire({title:"成功刪除所有商品",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1}),this.getCart()}).catch(t=>{this.$Swal.fire({icon:"error",title:t.response.data.message})})},...U(S,["addToCart","getCart"]),createOrder(o){const t=`${f}/v2/api/${m}/order`,i=this.form;p.post(t,{data:i}).then(n=>{this.$Swal.fire({icon:"success",title:"訂單成立"}),this.$refs.form.resetForm(),this.orderId=n.data.orderId,this.$router.push(`/paycheck/${n.data.orderId}`),localStorage.setItem("orderId",n.data.orderId),this.getCarts()}).catch(()=>{this.$Swal.fire({icon:"error",title:"訂單失敗"})})},useCoupon(o){const t=`${f}/v2/api/${m}/coupon`,i={data:{code:o}};p.post(t,i).then(n=>{this.getCart(),this.$Swal.fire({title:"套用成功",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1})}).catch(()=>{this.$Swal.fire({icon:"error",title:"套用失敗"})})},formatPrice(o){return o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},computed:{...B(S,["carts","final_total"])},mounted(){this.getCarts()}},j={class:"bg-primary"},R={class:"container text-info"},D={class:"row py-4"},F={class:"col-md-8 col-sm-12"},H={key:0,class:"d-flex justify-content-between mb-4"},M={key:1,class:"table-container"},O={class:"table align-middle"},z={class:"table-primary"},Q=["src"],G={class:"btn-group input-group-sm"},J=["onClick","disabled"],K=["onUpdate:modelValue","onChange","disabled"],W=["onClick"],X={style:{width:"20%"}},Y={style:{width:"10%"},class:"text-end"},Z=["onClick"],tt={key:2,class:"text-info d-flex align-items-center justify-content-center mb-2",style:{height:"300px","background-color":"rgba(99, 99, 99, 0.90)","z-index":"100"}},et={key:3,class:"border bg-secondary p-4"},st={class:"d-flex mb-2"},ot={class:"input-group total-coupon-input"},lt={key:0,class:"text-dark mb-2"},at={class:"d-flex justify-content-between mb-4"},nt={class:"d-flex justify-content-between"},rt={key:0,class:"col-md-4 col-sm-12"},it={class:"row justify-content-center py-4"},dt={class:"mb-3"},ut={class:"mb-3"},ct={class:"mb-3"},mt={class:"mb-3"},pt={class:"mb-3"};function ft(o,t,i,n,l,d){const q=b("Loading"),V=b("router-link"),h=b("v-field"),g=b("error-message"),I=b("v-form");return u(),c("div",j,[e("div",R,[r(q,{active:l.isLoading,"onUpdate:active":t[0]||(t[0]=s=>l.isLoading=s),"can-cancel":!1,"is-full-page":l.fullPage,loader:l.loader},null,8,["active","is-full-page","loader"]),t[25]||(t[25]=$('<div class="row py-md-6"><div class="col-md-3 pt-6 col-sm-5"><div class="border-bottom mb-2"><h2>訂單確認。</h2></div></div><div class="col-8"></div></div><div class="row text-center"><div class="col-4 step state rounded-start">1.填寫資料</div><div class="col-4 step">2.確認付款</div><div class="col-4 step rounded-end">3.完成訂單</div></div>',2)),e("div",D,[e("div",F,[o.carts.length>0?(u(),c("div",H,[r(V,{to:"/products"},{default:w(()=>t[9]||(t[9]=[e("button",{type:"submit",class:"btn btn-info"},"繼續購買",-1)])),_:1}),e("button",{type:"submit",class:"btn btn-outline-info",onClick:t[1]||(t[1]=(...s)=>d.deleteAllCarts&&d.deleteAllCarts(...s))},"清空購物車")])):y("",!0),o.carts.length>0?(u(),c("div",M,[e("table",O,[t[11]||(t[11]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"圖片"),e("th",null,"房名"),e("th",null,"數量"),e("th",null,"價格"),e("th")])],-1)),e("tbody",z,[(u(!0),c(E,null,N(l.cart.carts,s=>(u(),c("tr",{key:s.id},[e("td",null,[e("img",{src:s.product.imageUrl,style:{width:"80px",height:"100px"}},null,8,Q)]),e("td",null,[e("h5",null,_(s.product.title),1)]),e("td",null,[e("div",G,[e("button",{type:"button",class:"btn btn-secondary",onClick:a=>{s.qty--,d.changeCartQty(s,s.qty)},disabled:s.qty===1},"-",8,J),k(e("input",{min:"1",type:"number",class:"productNumber","onUpdate:modelValue":a=>s.qty=a,onChange:a=>d.changeCartQty(s,s.qty),disabled:s.qty===1,readonly:""},null,40,K),[[x,s.qty,void 0,{number:!0}]]),e("button",{type:"button",class:"btn btn-secondary",onClick:a=>s.qty++},"+",8,W)])]),e("td",X,[e("h5",null,"NT$"+_(s.product.price),1)]),e("td",Y,[e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>d.removeCartItem(s.id)},t[10]||(t[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-trash-fill",viewBox:"0 0 16 16"},[e("path",{d:"M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"})],-1)]),8,Z)])]))),128))])])])):(u(),c("div",tt,[t[13]||(t[13]=v(" 購物車沒有任何商品，趕快去看喜歡的房型吧! ")),r(V,{to:"/products"},{default:w(()=>t[12]||(t[12]=[e("button",{type:"submit",class:"btn btn-info ms-2"},"去逛逛",-1)])),_:1})])),o.carts.length>0?(u(),c("div",et,[t[16]||(t[16]=e("h2",null,"訂單明細",-1)),t[17]||(t[17]=e("hr",null,null,-1)),t[18]||(t[18]=e("div",{class:"d-flex justify-content-between mb-4"},null,-1)),e("div",st,[e("form",ot,[k(e("input",{type:"text",placeholder:"輸入酷碰序號",class:"form-control","aria-label":"Recipient's username","aria-describedby":"button-addon2","onUpdate:modelValue":t[2]||(t[2]=s=>l.coupon=s)},null,512),[[x,l.coupon]]),e("button",{type:"submit",class:"btn btn-primary",id:"button-addon2",onClick:t[3]||(t[3]=s=>d.useCoupon(l.coupon))},"套用")])]),l.cart.total-o.final_total?(u(),c("div",lt," 已套用優惠券 ")):y("",!0),e("div",at,[t[14]||(t[14]=e("h5",null,"酷碰券折抵",-1)),e("span",null,"NT$ "+_(d.formatPrice((l.cart.total-o.final_total).toFixed(0))),1)]),e("div",nt,[t[15]||(t[15]=e("h5",null,"共計",-1)),e("span",null,"NT$ "+_(d.formatPrice(o.final_total.toFixed(0))),1)])])):y("",!0)]),o.carts.length>0?(u(),c("div",rt,[e("div",it,[r(I,{ref:"form",onSubmit:d.createOrder},{default:w(({errors:s})=>[e("div",dt,[t[19]||(t[19]=e("label",{for:"email",class:"form-label"},[v("Email"),e("span",{class:"marker"},"*")],-1)),r(h,{id:"email",name:"email",type:"email",class:C(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.form.user.email,"onUpdate:modelValue":t[4]||(t[4]=a=>l.form.user.email=a)},null,8,["class","modelValue"]),r(g,{name:"email",class:"invalid-feedback"})]),e("div",ut,[t[20]||(t[20]=e("label",{for:"name",class:"form-label"},[v("收件人姓名"),e("span",{class:"marker"},"*")],-1)),r(h,{id:"name",name:"姓名",type:"text",class:C(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required","aria-required":"true",modelValue:l.form.user.name,"onUpdate:modelValue":t[5]||(t[5]=a=>l.form.user.name=a)},null,8,["class","modelValue"]),r(g,{name:"姓名",class:"invalid-feedback"})]),e("div",ct,[t[21]||(t[21]=e("label",{for:"tel",class:"form-label"},[v("收件人電話"),e("span",{class:"marker"},"*")],-1)),r(h,{id:"tel",name:"電話",type:"text",class:C(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:l.form.user.tel,"onUpdate:modelValue":t[6]||(t[6]=a=>l.form.user.tel=a)},null,8,["class","modelValue"]),r(g,{name:"電話",class:"invalid-feedback"})]),e("div",mt,[t[22]||(t[22]=e("label",{for:"address",class:"form-label"},[v("收件人地址"),e("span",{class:"marker"},"*")],-1)),r(h,{id:"address",name:"地址",type:"text",class:C(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.form.user.address,"onUpdate:modelValue":t[7]||(t[7]=a=>l.form.user.address=a)},null,8,["class","modelValue"]),r(g,{name:"地址",class:"invalid-feedback"})]),e("div",pt,[t[23]||(t[23]=e("label",{for:"message",class:"form-label"},"留言",-1)),k(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[8]||(t[8]=a=>l.form.message=a)},null,512),[[x,l.form.message]])]),t[24]||(t[24]=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-secondary"},"送出訂單")],-1))]),_:1},8,["onSubmit"])])])):y("",!0)])])])}const gt=T(A,[["render",ft]]);export{gt as default};
