import{_ as h,S as _,h as b,o as u,c as p,b as t,j as c,v as m,N as D,t as r,e as f,r as C,F as v,i as x,d as g}from"./index-W2fTsUi5.js";import{M as T}from"./modal-i1d0ji3Z.js";/* empty css              */var V={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:M,VITE_PATH:w}=V,k={props:["tempCoupons","isNew","clearInput"],emits:["update-coupon"],data(){return{couponModal:null,localTempCoupons:{},due_date:"",Swal:_}},components:{},methods:{showModal(){this.couponModal.show()},hideModal(){this.couponModal.hide()},setDueDate(){if(this.isNew===!0)this.due_date=this.localTempCoupons.getCurrentDate(),console.log("這個你",this.due_date);else{const s=new Date(this.tempCoupons.due_date*1e3),o=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");this.due_date=`${o}/${n}/${a}`,console.log(this.due_date,this.year,this.month,this.date)}},getCurrentDate(){const s=new Date,o=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),a=String(s.getDate()).padStart(2,"0");return`${o}/${n}/${a}`},updateCoupon(s){this.isLoading=!0,this.fullpage=!0;let o=`${M}/v2/api/${w}/admin/coupon`,n="post",a=s;this.isNew||(o=`${M}/v2/api/${w}/admin/coupon/${this.tempCoupons.id}`,n="put",a=this.tempCoupons),b[n](o,{data:a}).then(e=>{this.isLoading=!1,this.fullpage=!1,this.$emit("update"),_.fire({title:"已更新",icon:"success",position:"top-end",timer:1e3,showConfirmButton:!1}),this.hideModal()}).catch(e=>{this.$Swal.fire({icon:"error",title:e.response.data.message})})}},watch:{tempCoupons:{handler(){this.localTempCoupons=this.tempCoupons},deep:!0},due_date(){this.localTempCoupons.due_date=Math.floor(new Date(this.due_date)/1e3)}},mounted(){this.couponModal=new T(this.$refs.couponModal,{keyboard:!1,backdrop:"static"}),this.localTempCoupons=this.tempCoupons,this.setDueDate()}},E={id:"couponModal",ref:"couponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},L={class:"modal-content border-0"},U={class:"modal-header bg-dark text-white"},I={id:"couponLabel",class:"modal-title"},R={key:0},N={key:1},A={class:"modal-body"},P={class:"row"},B={class:"col-sm-12"},H={class:"mb-3 text-start"},O={class:"row text-start"},F={class:"mb-3 col-md-6"},j={class:"mb-3 col-md-6"},Y={class:"row text-start"},q={class:"mb-3 col-md-6"},z={class:"mb-3 text-start"},G={class:"form-check"},J={class:"modal-footer"};function K(s,o,n,a,e,d){return u(),p("div",E,[t("div",S,[t("div",L,[t("div",U,[t("h5",I,[n.isNew?(u(),p("span",R,"新增優惠卷")):(u(),p("span",N,"編輯優惠卷"))]),o[6]||(o[6]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",A,[t("div",P,[t("div",B,[t("div",H,[o[7]||(o[7]=t("label",{for:"title",class:"form-label"},"優惠券標題",-1)),c(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=l=>e.localTempCoupons.title=l)},null,512),[[m,e.localTempCoupons.title]])]),t("div",O,[t("div",F,[o[8]||(o[8]=t("label",{for:"category",class:"form-label"},"優惠卷代碼",-1)),c(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入代碼","onUpdate:modelValue":o[1]||(o[1]=l=>e.localTempCoupons.code=l)},null,512),[[m,e.localTempCoupons.code]])]),t("div",j,[o[9]||(o[9]=t("label",{for:"unit",class:"form-label"},"折扣百分比",-1)),c(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入數字","onUpdate:modelValue":o[2]||(o[2]=l=>e.localTempCoupons.percent=l)},null,512),[[m,e.localTempCoupons.percent,void 0,{number:!0}]])])]),t("div",Y,[t("div",q,[o[10]||(o[10]=t("label",{for:"dueDate",class:"form-label"},"到期日",-1)),c(t("input",{id:"dueDate",type:"number",min:"0",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=l=>e.due_date=l)},null,512),[[m,e.due_date]])])]),t("div",z,[t("div",G,[c(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=l=>e.localTempCoupons.is_enabled=l),"true-value":1,"false-value":0},null,512),[[D,e.localTempCoupons.is_enabled]]),o[11]||(o[11]=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])])]),t("div",J,[o[12]||(o[12]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=l=>d.updateCoupon(e.localTempCoupons))},r(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const Q=h(k,[["render",K]]);var W={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:X,VITE_PATH:Z}=W,tt={props:["coupons","tempCoupons","getCoupon"],data(){return{delCouponModal:null,data:""}},methods:{showModal(){this.delCouponModal.show()},hideModal(){this.delCouponModal.hide()},deleteCoupon(){const s=`${X}/api/${Z}/admin/coupon/${this.tempCoupons.id}`;b.delete(s,{data:this.tempCoupons}).then(o=>{this.$Swal.fire({icon:"success",title:"成功刪除產品",showConfirmButton:!1,timer:1500}),this.hideModal(),this.$emit("update")}).catch(o=>{alert(o.response.data.message)})}},mounted(){this.delCouponModal=new T(this.$refs.delCouponModal,{keyboard:!1,backdrop:"static"}),console.log(this.tempCoupons)}},ot={id:"delCouponModal",ref:"delCouponModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},et={class:"modal-dialog"},st={class:"modal-content border-0"},nt={class:"modal-body text-start"},lt={class:"modal-footer"};function at(s,o,n,a,e,d){return u(),p("div",ot,[t("div",et,[t("div",st,[o[5]||(o[5]=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delCouponModalLabel",class:"modal-title"},[t("span",null,"刪除優惠卷")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",nt,[o[1]||(o[1]=f(" 是否刪除 ")),o[2]||(o[2]=t("strong",{class:"text-danger"},[t("span",{class:"fw-bold"})],-1)),f(" "+r(n.tempCoupons.title)+" 優惠券 ",1),o[3]||(o[3]=t("div",{class:"mt-2"}," (刪除後將無法恢復)。 ",-1))]),t("div",lt,[o[4]||(o[4]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...l)=>d.deleteCoupon&&d.deleteCoupon(...l))}," 確認刪除 ")])])])],512)}const dt=h(tt,[["render",at]]);var it={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:ut,VITE_PATH:pt}=it,rt={data(){return{coupons:[],tempCoupons:{},pagination:{},isNew:!1,isLoading:!0}},components:{CouponModal:Q,CouponDelModal:dt},methods:{getCoupon(s=1){const o=`${ut}/v2/api/${pt}/admin/coupons?page=${s}`;b.get(o).then(n=>{const{coupons:a,pagination:e}=n.data;this.allCoupons=a,this.coupons=a,this.pagination=e}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})})},formatDate(s){return new Date(s*1e3).toLocaleDateString()},openCouponModal(s,o){s==="createNew"?(this.tempCoupon={due_date:Math.floor(new Date().getTime()/1e3),is_enabled:0},this.isNew=!0,this.$refs.couponModal.showModal()):s==="edit"?(this.tempCoupons={...o},this.isNew=!1,this.$refs.couponModal.showModal()):s==="delete"&&(this.tempCoupons={...o},this.$refs.couponDelModal.showModal())},clearInput(){this.tempCoupons={}}},mounted(){this.getCoupon()}},ct={class:"container"},mt={class:"d-flex justify-content-between py-4 py-md-5"},ht={class:"table table-hover mt-4"},bt={key:0,class:"text-success"},_t={key:1},ft={class:"btn-group"},Ct=["onClick"],vt=["onClick"];function gt(s,o,n,a,e,d){const l=C("CouponModal"),y=C("CouponDelModal");return u(),p(v,null,[t("div",ct,[t("div",mt,[o[1]||(o[1]=t("h2",{class:"fw-bold"},"酷碰管理",-1)),t("button",{class:"btn btn-outline-primary",onClick:o[0]||(o[0]=i=>d.openCouponModal("createNew"))}," + 新增酷碰卷 ")]),t("table",ht,[o[2]||(o[2]=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 名稱 "),t("th",null,"酷碰代碼"),t("th",{width:"120"}," 折扣 "),t("th",{width:"120"}," 期限 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1)),t("tbody",null,[(u(!0),p(v,null,x(e.coupons,i=>(u(),p("tr",{key:i.id},[t("td",null,r(i.title),1),t("td",null,r(i.code),1),t("td",null,r(i.percent)+"%",1),t("td",null,r(d.formatDate(i.due_date)),1),t("td",null,[i.is_enabled?(u(),p("span",bt,"啟用")):(u(),p("span",_t,"未啟用"))]),t("td",null,[t("div",ft,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:$=>d.openCouponModal("edit",i)}," 編輯 ",8,Ct),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>d.openCouponModal("delete",i)}," 刪除 ",8,vt)])])]))),128))])])]),g(l,{ref:"couponModal","temp-Coupons":e.tempCoupons,"is-new":e.isNew,"clear-input":d.clearInput,onUpdate:d.getCoupon},null,8,["temp-Coupons","is-new","clear-input","onUpdate"]),g(y,{ref:"couponDelModal","is-new":e.isNew,"temp-Coupons":e.tempCoupons,onUpdate:d.getCoupon},null,8,["is-new","temp-Coupons","onUpdate"])],64)}const yt=h(rt,[["render",gt]]);export{yt as default};
