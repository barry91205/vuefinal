import{_ as y,h as c,S as b,o as r,c as a,b as t,j as u,v as m,n as _,N as L,F as M,i as E,e as D,t as P,L as R,r as h,d as f}from"./index-W2fTsUi5.js";import{P as S}from"./PaginationView-AeELRzxR.js";import{M as V}from"./bootstrap.esm-TTjMTX3M.js";var C={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:w,VITE_PATH:k}=C,A={props:["currentProduct","isNew","getData"],data(){return{productModal:null,tempProduct:{imagesUrl:[]},formData:null}},methods:{addProduct(){c.post(`${w}/v2/api/${k}/admin/product`,{data:this.tempProduct}).then(s=>{b.fire({icon:"success",title:"成功新增商品",showConfirmButton:!1,timer:1500}),this.productModal.hide(),this.$emit("refreshProducts")}).catch(()=>{this.$Swal.fire({icon:"error",title:"新增失敗"})})},editProduct(){c.put(`${w}/v2/api/${k}/admin/product/${this.tempProduct.id}`,{data:this.tempProduct}).then(s=>{this.$emit("refreshProducts"),b.fire({icon:"success",title:"成功編輯商品",showConfirmButton:!1,timer:1500}),this.productModal.hide()}).catch(()=>{this.$Swal.fire({icon:"error",title:"編輯失敗"})})},uploadImg(s){this.formData=new FormData,this.formData.append("file-to-upload",s.target.files[0]),typeof this.formData=="object"&&c.post(`${w}/v2/api/${k}/admin/upload`,this.formData).then(o=>{this.tempProduct.imageUrl=o.data.imageUrl}).catch(()=>{this.$Swal.fire({icon:"error",title:"上傳失敗"})})}},watch:{currentProduct(){this.tempProduct=this.currentProduct}},mounted(){this.productModal=new V(this.$refs.productModal,{keyboard:!1,backdrop:"static"}),this.$emit("productInstance",this.productModal),this.tempProduct=this.currentProduct},computed:{}},B={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},N={class:"modal-content border-0"},O={class:"modal-header bg-dark text-white"},j={id:"productModalLabel",class:"modal-title"},F={key:0},z={key:1},q={class:"modal-body"},G={class:"row mb-4"},J={class:"col-sm-4"},K={class:"mb-2"},Q={class:"mb-3"},W={class:"mb-3"},X=["src"],Y={class:"col-sm-8"},Z={class:"mb-3"},tt={class:"row"},ot={class:"mb-3 col-md-6"},et={class:"mb-3 col-md-6"},st={class:"row"},lt={class:"mb-3 col-md-6"},dt={class:"mb-3 col-md-6"},rt={class:"mb-3"},at={class:"mb-3"},nt={class:"mb-3"},it={class:"form-check"},ut={class:"row mb-2"},ct={class:"mb-3"},mt=["for"],pt=["id","onUpdate:modelValue"],bt=["src"],ht={class:"modal-footer"};function ft(s,o,n,U,e,d){return r(),a("div",B,[t("div",H,[t("div",N,[t("div",O,[t("h5",j,[n.isNew?(r(),a("span",F,"新增產品")):(r(),a("span",z,"編輯產品"))]),o[14]||(o[14]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",q,[t("div",G,[t("div",J,[t("div",K,[t("div",Q,[o[15]||(o[15]=t("label",{for:"imageUrl",class:"form-label"},"輸入圖片網址",-1)),u(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":o[0]||(o[0]=l=>e.tempProduct.imageUrl=l)},null,512),[[m,e.tempProduct.imageUrl]])]),t("div",W,[o[16]||(o[16]=t("label",{for:"upload",class:"form-label"},"或 上傳圖片",-1)),t("input",{id:"upload",type:"file",name:"file-to-upload",onChange:o[1]||(o[1]=(...l)=>d.uploadImg&&d.uploadImg(...l))},null,32)]),e.tempProduct.imageUrl?(r(),a("img",{key:0,class:"img-fluid",src:e.tempProduct.imageUrl,alt:"主圖"},null,8,X)):_("",!0)])]),t("div",Y,[t("div",Z,[o[17]||(o[17]=t("label",{for:"title",class:"form-label"},"標題",-1)),u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[2]||(o[2]=l=>e.tempProduct.title=l)},null,512),[[m,e.tempProduct.title]])]),t("div",tt,[t("div",ot,[o[18]||(o[18]=t("label",{for:"category",class:"form-label"},"分類",-1)),u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[3]||(o[3]=l=>e.tempProduct.category=l)},null,512),[[m,e.tempProduct.category]])]),t("div",et,[o[19]||(o[19]=t("label",{for:"unit",class:"form-label"},"單位",-1)),u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[4]||(o[4]=l=>e.tempProduct.unit=l)},null,512),[[m,e.tempProduct.unit]])])]),t("div",st,[t("div",lt,[o[20]||(o[20]=t("label",{for:"origin_price",class:"form-label"},"原價",-1)),u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[5]||(o[5]=l=>e.tempProduct.origin_price=l)},null,512),[[m,e.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",dt,[o[21]||(o[21]=t("label",{for:"price",class:"form-label"},"售價",-1)),u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[6]||(o[6]=l=>e.tempProduct.price=l)},null,512),[[m,e.tempProduct.price,void 0,{number:!0}]])])]),o[25]||(o[25]=t("hr",null,null,-1)),t("div",rt,[o[22]||(o[22]=t("label",{for:"description",class:"form-label"},"產品描述",-1)),u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[7]||(o[7]=l=>e.tempProduct.description=l)},"                ",512),[[m,e.tempProduct.description]])]),t("div",at,[o[23]||(o[23]=t("label",{for:"content",class:"form-label"},"說明內容",-1)),u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[8]||(o[8]=l=>e.tempProduct.content=l)},"                ",512),[[m,e.tempProduct.content]])]),t("div",nt,[t("div",it,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[9]||(o[9]=l=>e.tempProduct.is_enabled=l)},null,512),[[L,e.tempProduct.is_enabled]]),o[24]||(o[24]=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1))])])])]),o[26]||(o[26]=t("h4",{class:"mb-2"},"多圖新增",-1)),e.tempProduct.imagesUrl?(r(),a(M,{key:0},[t("div",ut,[(r(!0),a(M,null,E(e.tempProduct.imagesUrl,(l,p)=>(r(),a("div",{class:"col-6 mb-1",key:p},[t("div",ct,[t("label",{for:"images"+p,class:"form-label"},"圖片網址",8,mt),u(t("input",{id:"images"+p,"onUpdate:modelValue":I=>e.tempProduct.imagesUrl[p]=I,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,pt),[[m,e.tempProduct.imagesUrl[p]]])]),t("img",{class:"images",src:l},null,8,bt)]))),128))]),!e.tempProduct.imagesUrl.length||e.tempProduct.imagesUrl.length<5?(r(),a("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100 mb-3",onClick:o[10]||(o[10]=l=>e.tempProduct.imagesUrl.push(""))}," 新增圖片 ")):_("",!0),e.tempProduct.imagesUrl.length?(r(),a("button",{key:1,class:"btn btn-outline-danger btn-sm d-block w-100",onClick:o[11]||(o[11]=l=>e.tempProduct.imagesUrl.pop())}," 刪除圖片 ")):_("",!0)],64)):_("",!0)]),t("div",ht,[o[27]||(o[27]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),n.isNew?(r(),a("button",{key:0,type:"button",class:"btn btn-primary",onClick:o[12]||(o[12]=(...l)=>d.addProduct&&d.addProduct(...l))}," 確認新增 ")):(r(),a("button",{key:1,type:"button",class:"btn btn-primary",onClick:o[13]||(o[13]=(...l)=>d.editProduct&&d.editProduct(...l))}," 確認變更 "))])])])],512)}const gt=y(A,[["render",ft]]);var Pt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:_t,VITE_PATH:vt}=Pt,Mt={props:["currentProduct"],data(){return{delProductModal:null}},methods:{delProduct(){c.delete(`${_t}/v2/api/${vt}/admin/product/${this.currentProduct.id}`).then(s=>{this.setSweetMessageSuccess(s.data.message),b.fire(this.sweetMessage),setTimeout(()=>{this.delProductModal.hide(),this.$emit("refreshProducts")},1500)}).catch(s=>{this.setSweetMessageError(s.data.message),b.fire(this.sweetMessage)})}},mounted(){this.delProductModal=new V(this.$refs.delProductModal,{keyboard:!1,backdrop:"static"}),this.$emit("productDeleteInstance",this.delProductModal)},computed:{}},yt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Ut={class:"modal-dialog"},It={class:"modal-content border-0"},wt={class:"modal-body"},kt={class:"text-danger"},Vt={class:"modal-footer"};function Dt(s,o,n,U,e,d){return r(),a("div",yt,[t("div",Ut,[t("div",It,[o[4]||(o[4]=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",wt,[o[1]||(o[1]=D(" 是否刪除 ")),t("strong",kt,P(n.currentProduct.title),1),o[2]||(o[2]=D(" 商品(刪除後將無法恢復)。 "))]),t("div",Vt,[o[3]||(o[3]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...l)=>d.delProduct&&d.delProduct(...l))}," 確認刪除 ")])])])],512)}const Et=y(Mt,[["render",Dt]]);var Tt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:$t,VITE_PATH:xt}=Tt,Lt={data(){return{uploadImgModal:null,formData:null,imageUrl:""}},methods:{uploadImg(){typeof this.formData=="object"&&c.post(`${$t}/api/${xt}/admin/upload`,this.formData).then(s=>{this.imageUrl=s.data.imageUrl,this.setSweetMessageSuccess("圖片新增成功"),b.fire(this.sweetMessage)}).catch(s=>{this.setSweetMessageError(s.message),b.fire(this.sweetMessage)})},handleUploadImg(s){this.formData=new FormData,this.formData.append("file-to-upload",s.target.files[0])}},mounted(){this.uploadImgModal=new V(this.$refs.uploadImgModal,{keyboard:!1,backdrop:"static"}),this.$emit("UploadImgInstance",this.uploadImgModal)},computed:{}},Rt={id:"uploadImgModal",ref:"uploadImgModal",class:"modal fade",tabindex:"-1","aria-labelledby":"uploadImgModalLabel","aria-hidden":"true"},St={class:"modal-dialog"},Ct={class:"modal-content border-0"},At={class:"modal-body"},Bt={class:"mb-2"},Ht=["src"],Nt={class:"mb-2"},Ot=["value"],jt={class:"modal-footer"};function Ft(s,o,n,U,e,d){return r(),a("div",Rt,[t("div",St,[t("div",Ct,[o[4]||(o[4]=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"上傳圖片")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",At,[t("form",Bt,[t("input",{type:"file",name:"file-to-upload",onChange:o[0]||(o[0]=(...l)=>d.handleUploadImg&&d.handleUploadImg(...l))},null,32)]),t("div",null,[t("img",{class:"mb-2",src:e.imageUrl},null,8,Ht),t("div",Nt,[o[2]||(o[2]=t("label",{for:"imgUrl",class:"form-label"},"圖片位址",-1)),t("input",{id:"imgUrl",type:"text",class:"form-control",value:e.imageUrl},null,8,Ot)])])]),t("div",jt,[o[3]||(o[3]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=(...l)=>d.uploadImg&&d.uploadImg(...l))}," 上傳 ")])])])],512)}const zt=y(Lt,[["render",Ft]]);var qt={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:g,VITE_PATH:v}=qt,Gt={data(){return{products:[],productModal:null,delProductModal:null,uploadImgModal:null,currentProduct:{imagesUrl:[]},currentPage:1,pages:{},isNew:!1,tempProduct:{imagesUrl:[]},pagination:{},isLoading:!0,loader:"bars"}},components:{Pagination:S,Loading:R,ProductModal:gt,UploadImgModal:zt,ProductDelModal:Et},methods:{checkAdmin(){const s=`${g}/v2/api/user/check`;c.post(s).then(o=>{}).catch(o=>{console.log(o),window.location="LoginView.vue"})},getData(s=1){this.isLoading=!0;const o=`${g}/v2/api/${v}/admin/products?page=${s}`;c.get(o).then(n=>{this.products=n.data.products,this.pagination=n.data.pagination,this.isLoading=!1}).catch(()=>{})},openModal(s,o){s==="productModal"?(this.currentProduct={imagesUrl:[]},this.isNew=!0,this.productModal.show()):s==="editModal"?(this.currentProduct={...o},this.isNew=!1,this.productModal.show()):s==="delProductModal"?(this.currentProduct=o,this.delProductModal.show()):s==="uploadImgModal"&&this.uploadImgModal.show()},getProductModal(s){this.productModal=s},getProductDeleteModal(s){this.delProduct=s},getUploadImgModal(s){this.uploadImgModal=s},refreshProducts(){this.getData(this.currentPage)},updateProduct(){let s=`${g}/v2/api/${v}/admin/product`,o="post";this.isNew||(s=`${g}/v2/api/${v}/admin/product/${this.tempProduct.id}`,o="put"),c[o](s,{data:this.tempProduct}).then(n=>{this.$refs.pModal.closeModal(),this.getData(),this.tempProduct={}}).catch(n=>{alert(n.response.data.message)})},delProduct(s){const o=`${g}/v2/api/${v}/admin/product/${s}`;console.log(this.tempProduct),c.delete(o).then(n=>{this.$Swal.fire({title:"確定刪除商品?",icon:"warning",showCancelButton:!0,confirmButtonText:"確定刪除",cancelButtonText:"取消"}),this.getData()}).catch(n=>{this.$Swal.fire({icon:"error",title:n.response.data.message})})}},mounted(){const s=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");c.defaults.headers.common.Authorization=s,this.checkAdmin(),this.getData()}},Jt={class:"container"},Kt={class:"d-flex justify-content-between py-4 py-md-5"},Qt={class:"table table-hover mt-4"},Wt={key:0,class:"text-success"},Xt={key:1},Yt={class:"btn-group"},Zt=["onClick"],to=["onClick"];function oo(s,o,n,U,e,d){const l=h("Loading"),p=h("Pagination"),I=h("Product-Modal"),T=h("Upload-Img-Modal"),$=h("Product-Del-Modal");return r(),a(M,null,[t("div",Jt,[t("div",Kt,[o[3]||(o[3]=t("h2",{class:"fw-bold"},"商品管理",-1)),t("div",null,[t("button",{onClick:o[0]||(o[0]=i=>d.openModal("uploadImgModal")),class:"btn btn-primary me-2"}," 上傳圖片 "),t("button",{class:"btn btn-outline-primary",onClick:o[1]||(o[1]=i=>d.openModal("productModal"))}," 建立新的產品 ")])]),t("table",Qt,[o[4]||(o[4]=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"房型名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"}," 編輯 ")])],-1)),t("tbody",null,[f(l,{active:e.isLoading,"onUpdate:active":o[2]||(o[2]=i=>e.isLoading=i),"can-cancel":!1,loader:e.loader},null,8,["active","loader"]),(r(!0),a(M,null,E(e.products,i=>(r(),a("tr",{key:i.id},[t("td",null,P(i.category),1),t("td",null,P(i.title),1),t("td",null,P(i.origin_price),1),t("td",null,P(i.price),1),t("td",null,[i.is_enabled?(r(),a("span",Wt,"啟用")):(r(),a("span",Xt,"未啟用"))]),t("td",null,[t("div",Yt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:x=>d.openModal("editModal",i)}," 編輯 ",8,Zt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:x=>d.openModal("delProductModal",i)}," 刪除 ",8,to)])])]))),128))])])]),f(p,{pagination:e.pagination,onEmitPages:d.getData},null,8,["pagination","onEmitPages"]),f(I,{"current-product":e.currentProduct,"is-new":e.isNew,onProductInstance:d.getProductModal,onRefreshProducts:d.refreshProducts},null,8,["current-product","is-new","onProductInstance","onRefreshProducts"]),f(T,{onUploadImgInstance:d.getUploadImgModal},null,8,["onUploadImgInstance"]),f($,{"current-product":e.currentProduct,onProductDeleteInstance:s.getProductDelModal,onRefreshProducts:d.refreshProducts},null,8,["current-product","onProductDeleteInstance","onRefreshProducts"])],64)}const ro=y(Gt,[["render",oo]]);export{ro as default};
