import{M as E}from"./modal-i1d0ji3Z.js";import{_ as v,h as y,S as k,o as r,c as l,b as e,t as d,j as c,v as m,n as _,F as b,i as g,O as V,e as h,r as f,d as O}from"./index-W2fTsUi5.js";import{P as T}from"./PaginationView-AeELRzxR.js";var $={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:D}=$,P={props:["tempOrder","getOrder"],data(){return{orderEdittModal:null,order:{}}},methods:{showModal(){this.orderEdittModal.show()},hideModal(){this.orderEdittModal.hide()},updateOrder(){const a=`${U}/v2/api/${D}/admin/order/${this.tempOrder.id}`;y["put"](a,{data:this.tempOrder}).then(n=>{this.$emit("update"),k.fire({icon:"success",title:"成功取得產品資訊",showConfirmButton:!1,timer:1500}),this.hideModal()}).catch(n=>{alert(n.response.data.message)})}},watch:{tempOrder(){this.order=this.tempOrder}},mounted(){this.orderEdittModal=new E(this.$refs.OrderEditModal,{keyboard:!1,backdrop:"static"})}},I={id:"OrderEditModal",ref:"OrderEditModal",class:"modal fade",tabindex:"-1","aria-labelledby":"OrderEditModal","aria-hidden":"true"},L={class:"modal-dialog modal-xl"},R={class:"modal-content border-0"},S={class:"modal-header bg-dark text-white"},A={id:"OrderEditModal",class:"modal-title"},C={class:"modal-body text-start"},B={class:"h5 fw-bold"},H={class:"h5 fw-bold"},N={class:"row"},j={class:"col-sm-12"},q={class:"row mb-2"},z={key:0,class:"row"},F={class:"col-md-6 mb-4"},G={class:"col-md-6 mb-4"},J={class:"col-md-6 mb-4"},K={class:"col-md-6 mb-4"},Q={class:"col-md-12 mb-4"},W={class:"col-md-12 mb-1"},X={key:0,class:"text-success"},Y={key:1,class:"text-danger fw-bold"},Z={class:"row mt-2"},ee={class:"col-lg-12"},te={key:0,class:"mb-2"},se={class:"table table-hover border rounded rounded-3"},oe={class:"ps-3 py-2 text-center"},de={scope:"row"},re={class:"d-flex justify-content-center"},le={style:{width:"180px"}},ne={class:"text-end"},ae={class:"text-end fw-bold me-2"},ie={class:"modal-footer"};function ue(a,t,n,M,o,i){return r(),l("div",I,[e("div",L,[e("div",R,[e("div",S,[e("h5",A,[e("span",null,"編輯訂單 "+d(n.tempOrder.id),1)]),t[6]||(t[6]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",C,[e("div",B,"訂單編號："+d(n.tempOrder.id),1),e("div",H,"訂單日期： "+d(new Date(o.order.create_at*1e3).toLocaleDateString()),1),t[15]||(t[15]=e("hr",null,null,-1)),e("div",N,[e("div",j,[e("div",q,[o.order.user?(r(),l("div",z,[e("div",F,[t[7]||(t[7]=e("label",{for:"people",class:"form-label"},"訂購人姓名",-1)),c(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=s=>o.order.user.name=s),disabled:""},null,512),[[m,o.order.user.name]])]),e("div",G,[t[8]||(t[8]=e("label",{for:"people",class:"form-label"},"訂單電話",-1)),c(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=s=>o.order.user.tel=s),disabled:""},null,512),[[m,o.order.user.tel]])]),e("div",J,[t[9]||(t[9]=e("label",{for:"people",class:"form-label"},"訂單電子郵件",-1)),c(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=s=>o.order.user.email=s),disabled:""},null,512),[[m,o.order.user.email]])]),e("div",K,[t[10]||(t[10]=e("label",{for:"people",class:"form-label"},"訂單電子郵件",-1)),c(e("input",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=s=>o.order.user.address=s),disabled:""},null,512),[[m,o.order.user.address]])]),e("div",Q,[t[11]||(t[11]=e("label",{for:"people",class:"form-label"},"訂單留言",-1)),c(e("textarea",{id:"people",type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=s=>o.order.message=s),disabled:""},"                               ",512),[[m,o.order.message]])]),e("div",W,[t[12]||(t[12]=e("label",{for:"people",class:"form-label mb-2"},"付款狀態",-1)),e("div",null,[o.order.is_paid?(r(),l("span",X,"已付款")):(r(),l("span",Y,"未付款"))])])])):_("",!0)]),t[14]||(t[14]=e("hr",null,null,-1)),e("div",Z,[e("div",ee,[n.tempOrder&&n.tempOrder.products?(r(),l("div",te," 訂單內容 ("+d(Object.keys(n.tempOrder.products).length)+") ",1)):_("",!0),e("table",se,[t[13]||(t[13]=e("thead",null,[e("tr",{class:"text-center"},[e("th",{scope:"col"}," 編號"),e("th",{colspan:"1",scope:"col"},"房型圖"),e("th",{colspan:"1",scope:"col"},"房名/單位"),e("th",{colspan:"1",scope:"col",class:"text-end"},"小計")])],-1)),e("tbody",oe,[(r(!0),l(b,null,g(o.order.products,s=>(r(),l("tr",{key:s.id,class:"align-middle"},[e("th",de,d(s.product.num),1),e("td",re,[e("div",le,[e("div",{class:"rounded",style:V([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.product.imageUrl})`}])},null,4)])]),e("td",null,d(s.product.title)+" x "+d(s.qty)+" / "+d(s.product.unit),1),e("td",ne,d(s.total)+" 元 ",1)]))),128))])]),e("p",ae,"總金額："+d(o.order.total),1)])])])])]),e("div",ie,[t[16]||(t[16]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=(...s)=>i.updateOrder&&i.updateOrder(...s))}," 確認 ")])])])],512)}const pe=v(P,[["render",ue]]);var ce={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:me,VITE_PATH:be}=ce,he={props:["tempOrder","getOrder"],data(){return{delOrderModal:null}},methods:{showModal(){this.delOrderModal.show()},hideModal(){this.delOrderModal.hide()},deleteOrder(){const a=`${me}/v2/api/${be}/admin/order/${this.tempOrder.id}`;y.delete(a,{data:this.tempOrder}).then(t=>{this.$Swal.fire({icon:"success",title:"成功刪除產品",showConfirmButton:!1,timer:1500}),this.$emit("update"),this.hideModal()}).catch(t=>{alert(t.response.data.message)})}},mounted(){this.delOrderModal=new E(this.$refs.delOrderModal,{keyboard:!1,backdrop:"static"}),console.log(this.orders)}},_e={id:"delOrderModal",ref:"delOrderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},fe={class:"modal-dialog"},Oe={class:"modal-content border-0"},ge={class:"modal-header bg-danger text-white"},ve={id:"delProductModalLabel",class:"modal-title"},ye={class:"modal-body text-start"},Me={class:"text-danger"},Ee={class:"fw-bold"},we={class:"modal-footer"};function xe(a,t,n,M,o,i){return r(),l("div",_e,[e("div",fe,[e("div",Oe,[e("div",ge,[e("h5",ve,[e("span",null,"訂單編號"+d(n.tempOrder.id),1)]),t[1]||(t[1]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ye,[t[2]||(t[2]=h(" 是否刪除訂單編號為 ")),e("strong",Me,[e("span",Ee,d(n.tempOrder.id),1)]),t[3]||(t[3]=h(" 訂單？ ")),t[4]||(t[4]=e("div",{class:"mt-2"}," (刪除後將無法恢復)。 ",-1))]),e("div",we,[t[5]||(t[5]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1)),e("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...s)=>i.deleteOrder&&i.deleteOrder(...s))}," 確認刪除 ")])])])],512)}const ke=v(he,[["render",xe]]);var Ve={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"kun123",BASE_URL:"/vuefinal/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:Te,VITE_PATH:$e}=Ve,Ue={data(){return{productsData:[],orders:[],tempOrder:{},pagination:{},isLoading:!0,page:{}}},components:{OrderEditModal:pe,OrdelDelModal:ke,Pagination:T},methods:{getOrder(a=1){y.get(`${Te}/v2/api/${$e}/admin/orders?page=${a}`).then(t=>{this.orders=t.data.orders,this.productsData=t.data.orders,this.pagination=t.data.pagination}).catch(t=>{this.$Swal.fire({icon:"error",title:t.response.data.message})})},openModal(a,t){a==="edit"?(this.tempOrder={...t},this.status=!1,console.log(this.tempOrder),this.$refs.orderEditModal.showModal()):a==="delete"&&(this.tempOrder={...t},console.log(this.tempOrder),this.$refs.delOrderModal.showModal())}},mounted(){this.getOrder()}},De={class:"container"},Pe={class:"table-hover table mt-4"},Ie={key:0,class:"text-success"},Le={key:1,class:"text-danger"},Re={class:"btn-group"},Se=["onClick"],Ae={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ce=["onClick"],Be={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function He(a,t,n,M,o,i){const s=f("Pagination"),w=f("OrderEditModal"),x=f("OrdelDelModal");return r(),l(b,null,[e("div",De,[t[4]||(t[4]=e("h2",{class:"fw-bold py-4"},"訂單管理",-1)),e("table",Pe,[t[3]||(t[3]=e("thead",{class:"bg-dark"},[e("tr",{class:"align-middle"},[e("th",{width:"120"},"訂單編號"),e("th",{width:"120"},"訂單時間"),e("th",{width:"120"},"訂房者"),e("th",{width:"120"},"訂購房型"),e("th",{width:"120"},"應付金額"),e("th",{width:"120"},"狀態"),e("th",{width:"120"},"編輯")])],-1)),e("tbody",null,[(r(!0),l(b,null,g(o.orders,u=>(r(),l("tr",{key:u.id},[e("td",null,d(u.id),1),e("td",null,d(new Date(u.create_at*1e3).toLocaleDateString()),1),e("td",null,d(u.user.name),1),e("td",null,[(r(!0),l(b,null,g(u.products,p=>(r(),l(b,{key:p.id},[h(d(p.product.title)+" x"+d(p.qty),1),t[0]||(t[0]=e("br",null,null,-1))],64))),128))]),e("td",null,d(u.total),1),e("td",null,[u.is_paid?(r(),l("span",Ie,"已付款")):(r(),l("span",Le,"未付款"))]),e("td",null,[e("div",Re,[e("button",{type:"button",class:"btn btn-outline-secondary btn-sm",onClick:p=>i.openModal("edit",u)},[u.num===0?(r(),l("span",Ae)):_("",!0),t[1]||(t[1]=h(" 編輯 "))],8,Se),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>i.openModal("delete",u)},[u.num===0?(r(),l("span",Be)):_("",!0),t[2]||(t[2]=h(" 刪除 "))],8,Ce)])])]))),128))])]),O(s,{pagination:o.pagination,onEmitPages:i.getOrder},null,8,["pagination","onEmitPages"])]),O(w,{ref:"orderEditModal","temp-order":o.tempOrder,onUpdate:i.getOrder},null,8,["temp-order","onUpdate"]),O(x,{ref:"delOrderModal","temp-order":o.tempOrder,onUpdate:i.getOrder},null,8,["temp-order","onUpdate"])],64)}const ze=v(Ue,[["render",He]]);export{ze as default};
